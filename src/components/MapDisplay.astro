---
// src/components/MapDisplay.astro
interface Props {
  latitude: number;
  longitude: number;
  locationName: string;
}

const { latitude, longitude, locationName } = Astro.props;
---

<div id="map" class="w-full h-96 rounded-lg shadow-md mb-6"></div>

<script is:inline>
  // Load Leaflet.js CSS
  const link = document.createElement('link');
  link.rel = 'stylesheet';
  link.href = 'https://unpkg.com/leaflet@1.9.4/dist/leaflet.css';
  link.integrity = 'sha256-p4NxAoJBhfR57tMHFQhggR5leFVcCEpmcl4fgvkyW0Y=';
  link.crossOrigin = '';
  document.head.appendChild(link);

  // Load Leaflet.js JS
  const script = document.createElement('script');
  script.src = 'https://unpkg.com/leaflet@1.9.4/dist/leaflet.js';
  script.integrity = 'sha256-20nEFjJZGoA72XG3X1e9C3x+x3x7yP+Wd2jKx+Yw3gA=';
  script.crossOrigin = '';
  script.onload = () => {
    // Ensure the map element exists before initializing
    if (document.getElementById('map')) {
      const map = L.map('map').setView([parseFloat(mapEl.dataset.lat), parseFloat(mapEl.dataset.lon)], 13);

      L.tileLayer('https://tile.openstreetmap.org/{z}/{x}/{y}.png', {
          maxZoom: 19,
          attribution: '&copy; <a href="http://www.openstreetmap.org/copyright">OpenStreetMap</a>'
      }).addTo(map);

      L.marker([parseFloat(mapEl.dataset.lat), parseFloat(mapEl.dataset.lon)])
        .addTo(map)
        .bindPopup(mapEl.dataset.name)
        .openPopup();
    }
  };
  document.head.appendChild(script);

  // Pass data to script via data attributes on the map div
  const mapEl = document.getElementById('map');
  if (mapEl) {
    mapEl.dataset.lat = String({latitude});
    mapEl.dataset.lon = String({longitude});
    mapEl.dataset.name = {locationName};
  }
</script>